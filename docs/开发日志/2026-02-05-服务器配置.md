# 开发日志 - 2026-02-05 服务器配置

## 今日任务
- [x] 配置 Swap（2GB）
- [x] 开启 BBR 网络加速（容器环境跳过）
- [x] 安装 Docker 和 Docker Compose
- [x] 安装 Nginx
- [x] 更新项目进度文档

## 服务器信息

| 项目 | 值 |
|------|-----|
| 环境类型 | Ubuntu 22.04 容器（AutoDL） |
| 操作系统 | Ubuntu 22.04.5 LTS (Jammy Jellyfish) |
| 内核版本 | 5.15.0-139-generic |
| CPU | 2核 Intel Xeon Platinum |
| 内存 | 1TB（共享） |
| 磁盘 | 充足 |

## 配置结果

### 1. Swap 配置 ✅

**状态**：已配置（由宿主机管理）

```bash
$ free -h
               total        used        free      shared  buff/cache   available
Mem:           1.0Ti        65Gi        91Gi       195Mi       850Gi       934Gi
Swap:          2.0Gi       591M       1.4Gi
```

**结论**：Swap 已配置 2GB，状态良好，无需额外配置。

### 2. BBR 网络加速 ⚠️

**状态**：容器环境无法配置

**原因**：
- 当前环境是容器（Container），不是完整虚拟机
- BBR 是内核级优化，需要在宿主机内核配置
- 容器内无法执行 `modprobe` 命令

**当前拥塞控制算法**：`cubic`

**建议**：在正式部署到阿里云服务器时配置 BBR。

### 3. Docker 安装 ✅

**安装命令**：
```bash
apt install -y docker.io docker-compose
```

**版本信息**：
- Docker: `28.2.2`
- Docker Compose: `1.29.2`

**验证**：
```bash
$ docker --version
Docker version 28.2.2, build 28.2.2-0ubuntu1~22.04.1

$ docker-compose --version
docker-compose version 1.29.2, build unknown
```

### 4. Nginx 安装 ✅

**安装命令**：
```bash
apt install -y nginx
```

**版本信息**：
- Nginx: `1.18.0 (Ubuntu)`

**验证**：
```bash
$ nginx -v
nginx version: nginx/1.18.0 (Ubuntu)
```

## 遇到的问题

### 问题 1: Docker 官方仓库连接失败
**现象**：
```
Err:6 https://download.docker.com/linux/ubuntu jammy InRelease
  Could not handshake: Error in the pull function.
```

**解决**：使用 Ubuntu 官方仓库安装
```bash
apt install -y docker.io docker-compose
```

### 问题 2: 容器环境限制
**现象**：无法执行 `modprobe tcp_bbr`

**原因**：容器没有内核权限

**解决**：BBR 配置推迟到正式服务器部署时进行

## 验证结果

| 配置项 | 状态 | 版本/说明 |
|--------|------|-----------|
| Swap | ✅ 已配置 | 2GB（宿主机管理） |
| BBR | ⚠️ 跳过 | 容器环境不支持 |
| Docker | ✅ 已安装 | 28.2.2 |
| Docker Compose | ✅ 已安装 | 1.29.2 |
| Nginx | ✅ 已安装 | 1.18.0 |

## 下一步

1. **本地开发**：FastAPI 后端 + Vue 前端
2. **编写 Docker 配置**：docker-compose.yml
3. **阿里云部署**：在正式服务器上配置 BBR

## 相关提交

- 提交：`2238f5b` - docs: 更新所有文档，完善Git仓库配置信息

## 环境差异说明

### 开发环境 vs 生产环境

| 对比项 | 开发环境 (AutoDL) | 生产环境 (阿里云) | 影响 |
|--------|-------------------|-------------------|------|
| **操作系统** | Ubuntu 22.04 | Debian 12 | 差异较小，都基于 Debian |
| **Nginx 版本** | 1.18.0 | 1.22.1 | 配置文件兼容，功能略有差异 |
| **Docker 版本** | 28.2.2 | 20.10.24 | 新版功能更多，基本兼容 |
| **BBR 加速** | ❌ 不支持（容器） | ✅ 已开启 | 生产环境网络性能更好 |
| **内存** | 1TB（共享） | 1.6GB（独享） | 开发环境资源更充足 |
| **Swap** | 2GB（宿主机管理） | 2GB（手动配置） | 都已配置 |

### 应对策略

使用 **Docker 统一环境** 抹平系统差异：

1. **开发阶段**：在 AutoDL Ubuntu 编写代码和 Dockerfile
2. **测试阶段**：使用 Docker 构建并本地测试
3. **部署阶段**：将相同镜像部署到阿里云 Debian
4. **优势**：开发和生产使用完全相同的容器环境

### 注意事项

- Python 版本需保持一致（3.11+）
- Node.js 版本需保持一致（18+）
- 数据库 SQLite 文件路径需统一
- 环境变量配置需分别管理

## 备注

- **开发环境**：AutoDL Ubuntu 22.04 容器 ✅
- **生产环境**：阿里云 Debian 12.10 ✅
- **当前阶段**：Day 1 - 基础设施配置完成

# 开发日志 - 2026-02-05 阿里云服务器配置

## 今日任务
- [x] 配置 Swap（2GB）
- [x] 开启 BBR 网络加速
- [x] 安装 Docker 和 Docker Compose
- [x] 安装 Nginx
- [x] 验证所有配置

## 服务器信息

| 项目 | 值 |
|------|-----|
| 公网IP | 8.135.6.165 |
| 操作系统 | Debian GNU/Linux 12 (bookworm) |
| 内存 | 1.6GB |
| 内核版本 | 支持 BBR |

## 配置结果

### 1. Swap 配置 ✅

```bash
$ free -h
               total        used        free      shared  buff/cache   available
Mem:           1.6Gi       380Mi       287Mi       2.1Mi       1.1Gi       1.3Gi
Swap:          2.0Gi          0B       2.0Gi
```

**配置命令**:
```bash
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' >> /etc/fstab
```

### 2. BBR 网络加速 ✅

```bash
$ sysctl net.ipv4.tcp_congestion_control
net.ipv4.tcp_congestion_control = bbr
```

**配置命令**:
```bash
modprobe tcp_bbr
echo 'tcp_bbr' >> /etc/modules-load.d/modules.conf
echo 'net.core.default_qdisc=fq' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_congestion_control=bbr' >> /etc/sysctl.conf
sysctl -p
```

### 3. Docker 安装 ✅

**版本信息**:
- Docker: `20.10.24+dfsg1`
- Docker Compose: `1.29.2`

**安装命令**:
```bash
apt update
apt install -y docker.io docker-compose
systemctl start docker
systemctl enable docker
```

**注意**: 使用 Debian 官方仓库安装（Docker 官方仓库连接失败）

### 4. Nginx 安装 ✅

**版本信息**:
- Nginx: `1.22.1`

**状态**: 运行中 ✅

```bash
$ systemctl status nginx
● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled;)
     Active: active (running)
```

**安装命令**:
```bash
apt install -y nginx
systemctl start nginx
systemctl enable nginx
```

## 遇到的问题

### 问题 1: Docker 官方仓库连接失败
**现象**: `curl: (35) Recv failure: Connection reset by peer`

**解决**: 使用 Debian 官方仓库安装
```bash
apt install -y docker.io docker-compose
```

## 验证结果

| 配置项 | 状态 | 版本/说明 |
|--------|------|-----------|
| Swap | ✅ 已配置 | 2GB |
| BBR | ✅ 已开启 | bbr |
| Docker | ✅ 已安装 | 20.10.24 |
| Docker Compose | ✅ 已安装 | 1.29.2 |
| Nginx | ✅ 已安装 | 1.22.1 (运行中) |

## 下一步

1. **本地开发**: FastAPI 后端 + Vue 前端
2. **编写 Docker 配置**: docker-compose.yml
3. **部署到阿里云**: 使用 Docker 部署应用

## 服务器访问

```bash
# SSH 连接
ssh root@8.135.6.165

# 检查服务状态
systemctl status docker
systemctl status nginx

# 查看配置
free -h
sysctl net.ipv4.tcp_congestion_control
docker --version
nginx -v
```

## 环境差异说明

### 生产环境 vs 开发环境

| 对比项 | 生产环境 (阿里云) | 开发环境 (AutoDL) | 说明 |
|--------|-------------------|-------------------|------|
| **操作系统** | Debian 12 | Ubuntu 22.04 | 都基于 Debian，差异较小 |
| **Nginx 版本** | 1.22.1 | 1.18.0 | 生产环境版本较新 |
| **Docker 版本** | 20.10.24 | 28.2.2 | 开发环境版本较新 |
| **BBR 加速** | ✅ 已开启 | ❌ 不支持 | 容器无法修改内核参数 |
| **内存** | 1.6GB（独享） | 1TB（共享） | 开发环境资源更充足 |
| **Swap** | 2GB（手动配置） | 2GB（宿主机管理） | 都已配置 |

### 统一策略

使用 **Docker 容器化** 抹平环境差异：
- 开发和生产使用相同的 Docker 镜像
- 通过 docker-compose.yml 统一管理
- 环境差异通过环境变量隔离

### 注意事项

- 生产环境 Nginx 版本较新，配置需兼容
- 开发环境 Docker 版本较新，避免使用太新的特性
- BBR 仅在生产环境生效，开发环境不依赖网络加速

## 备注

- **生产环境**: 阿里云 Debian 12 服务器 ✅ 配置完成
- **开发环境**: AutoDL Ubuntu 22.04 容器 ✅ 配置完成
- **当前阶段**: Day 1 - 基础设施配置全部完成

# 认知实验平台 - 完整实施计划书

> 版本：v2.2  
> 更新日期：2026-02-05  
> 适用服务器：阿里云 2核2G（Debian 12.10）
> 域名：cognitive-testing.cn  
> 实验名称：认知行为-Mnist数字识别实验

---

## 更新记录

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v2.2 | 2026-02-05 | 添加服务器检查结果、项目进度跟踪 |
| v2.1 | 2026-02-05 | 完善实验流程、技术选型说明、PsychoJS改造方案 |
| v2.0 | 2026-02-05 | 初始完整版本 |

---

## 一、项目概述

### 1.1 核心需求
- **实验类型**：图片呈现 + 按键反应收集（F键/K键）
- **用户类型**：注册用户（邮箱）+ 匿名用户（练习模式）
- **关键特性**：支持跨会话继续实验（今天做一部分，明天继续）
- **性能目标**：国内流畅访问，适配 2C/2G 服务器
- **开源计划**：完整开源至 GitHub/Gitee

### 1.2 实验规模

| 参数 | 数值 | 说明 |
|------|------|------|
| 图片资源 | 1,800 张 | 790 KB（非常小，参考 MNIST）|
| 练习试次 | 24-80 个 | 用户可选：24/40/60/80 |
| 练习达标标准 | ≥70% 正确率 | 达标后方可进入正式实验 |
| 正式实验轮数 | 45 轮 | 每轮 40 张图片 |
| 总试次数 | 1,800 试次 | 45 × 40 |
| 预计完成时间 | 45-90 分钟 | 每轮 1-2 分钟 |
| 轮次间隔警告 | >1 天 | 提示数据可靠性可能降低 |

**关键结论**：
- ✅ 图片资源很小（790KB），**不需要 OSS**，直接放服务器即可
- ✅ 45 轮实验必须支持**断点续做**（分多天完成）
- ⚠️ 需要设计**轮次进度保存**机制
- ⚠️ 需要记录每轮实验时间，间隔>1天给出警告

### 1.3 实验流程结构

```
┌─────────────────────────────────────────────────────────────────┐
│  1. welcomeRoutine    - 欢迎页面                                 │
├─────────────────────────────────────────────────────────────────┤
│  2. practiceRoutine   - 练习说明页                               │
│     - 选择练习试次数（24/40/60/80）                              │
│     - 全屏显示警告说明                                           │
├─────────────────────────────────────────────────────────────────┤
│  3. test_loop         - 练习试次循环（可重复直到达标）            │
│     ├─ testRoutine      - 试次呈现                              │
│     ├─ slider_test      - 滑块/反应收集                          │
│     └─ fbRoutine        - 反馈                                  │
├─────────────────────────────────────────────────────────────────┤
│  4. test_endRoutine   - 练习结束页                               │
│     - 显示正确率                                                 │
│     - 达标(≥70%)：进入正式实验                                   │
│     - 未达标：可选择重新练习                                     │
├─────────────────────────────────────────────────────────────────┤
│  5. formalRoutine     - 正式实验说明页                           │
│     - 全屏显示警告                                               │
│     - 中断警告（点击其他地方会导致实验中断）                      │
├─────────────────────────────────────────────────────────────────┤
│  6. trialsLoop        - 正式实验循环（45轮 × 40试次）            │
│     ├─ tipRoutine       - 每轮提示                              │
│     │   - 检查轮次间隔（>1天显示警告）                           │
│     ├─ trials_2Loop     - 子循环（每轮内的试次）                  │
│     │   - 全屏显示                                               │
│     │   - 中断检测                                               │
│     └─ fb2Routine       - 每轮反馈                              │
├─────────────────────────────────────────────────────────────────┤
│  7. overRoutine       - 实验结束感谢页                           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 二、技术选型说明

### 2.1 操作系统：Debian 12.10

| 对比项 | Debian 12 | Ubuntu 24.04 |
|--------|-----------|--------------|
| **资源占用** | ✅ 更低（适合2G内存） | 稍高 |
| **稳定性** | ✅ 更高（生产环境首选） | 较好 |
| **软件版本** | 较保守（经过充分测试） | 较新 |
| **Docker支持** | ✅ 完美支持 | 完美支持 |
| **社区文档** | 丰富 | ✅ 更丰富 |
| **学习曲线** | 稍陡 | ✅ 更友好 |

**结论**：对于2C/2G服务器，**Debian 12.10是更好的选择**，资源占用更低，稳定性更高。

### 2.2 Nginx 反向代理

#### 简单原理
```
用户请求 → Nginx → 分流处理
                    ├── 静态文件（图片/CSS/JS）→ 直接返回
                    ├── API请求 (/api/*) → 转发给 FastAPI
                    └── 前端页面 → 转发给 Vue
```

#### 核心功能
1. **反向代理**：将不同请求转发给不同服务
2. **负载均衡**：分发请求到多个后端
3. **静态资源服务**：直接提供图片/文件（比Python更快）
4. **SSL终止**：处理HTTPS加密解密

#### 优缺点

| 优点 | 缺点 |
|------|------|
| 性能极高（C语言编写） | 配置语法较复杂 |
| 内存占用低（适合小服务器） | 动态模块需要编译 |
| 稳定性好 | |
| 社区庞大，文档丰富 | |

#### 同类技术对比

| 技术 | 性能 | 内存占用 | 适用场景 |
|------|------|----------|----------|
| **Nginx** | ⭐⭐⭐ | ⭐⭐⭐（最低） | 首选，全能型 |
| Apache | ⭐⭐ | ⭐⭐ | 传统项目，.htaccess |
| Caddy | ⭐⭐⭐ | ⭐⭐ | 自动HTTPS，配置简单 |
| Traefik | ⭐⭐⭐ | ⭐⭐ | 云原生，Docker集成好 |

**推荐**：本项目使用 **Nginx**，成熟稳定，资源占用最低。

---

## 三、数据库设计

### 3.1 数据表结构

#### 表1：users（用户表）
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email VARCHAR(255) UNIQUE,           -- 注册用户邮箱
    password_hash VARCHAR(255),          -- 密码哈希
    subject_id VARCHAR(50) UNIQUE,       -- 被试编号 S001, S002...
    user_type VARCHAR(20) DEFAULT 'registered', -- registered/anonymous
    age INTEGER,
    gender VARCHAR(10),
    education VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP
);
```

#### 表2：experiment_sessions（实验会话表）
```sql
CREATE TABLE experiment_sessions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER FOREIGN KEY,
    session_type VARCHAR(20),            -- practice/formal
    practice_trials INTEGER,             -- 用户选择的练习试次数
    practice_accuracy FLOAT,             -- 练习正确率
    practice_passed BOOLEAN,             -- 是否通过练习
    current_round INTEGER DEFAULT 0,     -- 当前完成到第几轮
    total_rounds INTEGER DEFAULT 45,     -- 总轮数
    trials_per_round INTEGER DEFAULT 40, -- 每轮试次数
    status VARCHAR(20),                  -- in_progress/completed/abandoned
    started_at TIMESTAMP,
    last_activity TIMESTAMP,
    completed_at TIMESTAMP
);
```

#### 表3：round_data（轮次数据表）
```sql
CREATE TABLE round_data (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id INTEGER FOREIGN KEY,
    user_id INTEGER FOREIGN KEY,
    round_number INTEGER,                -- 第几轮
    file_path VARCHAR(500),              -- CSV文件路径
    trial_count INTEGER,                 -- 试次数
    accuracy FLOAT,                      -- 正确率
    avg_rt FLOAT,                        -- 平均反应时
    started_at TIMESTAMP,                -- 本轮开始时间
    completed_at TIMESTAMP,              -- 本轮完成时间
    days_since_last_round FLOAT          -- 距上轮间隔天数
);
```

### 3.2 文件存储结构

```
/data
├── /database
│   └── experiment.db
├── /backups
│   └── /daily
├── /subjects
│   ├── /registered
│   │   └── /S001
│   │       ├── session_1.json          -- 会话信息
│   │       ├── /practice
│   │       │   └── practice_data.csv   -- 练习数据
│   │       ├── /rounds
│   │       │   ├── round_01_20260205_143022.csv
│   │       │   ├── round_02_20260205_145530.csv
│   │       │   └── ...
│   │       └── /incomplete             -- 未完成轮次的临时数据
│   │           └── round_03_temp.json
│   └── /anonymous
│       └── /ANON_001
│           └── /practice
│               └── practice_data.csv
├── /resources
│   └── /generated_dataset
│       ├── /simple
│       ├── /complex
│       └── /sub
└── /logs
    └── app.log
```

---

## 四、API 接口规范

### 4.1 认证模块

#### POST /api/v1/auth/register
```json
// Request
{
  "email": "user@example.com",
  "password": "secure_password",
  "age": 25,
  "gender": "male",
  "education": "本科"
}

// Response
{
  "success": true,
  "data": {
    "user_id": 1,
    "subject_id": "S001",
    "message": "注册成功"
  }
}
```

#### POST /api/v1/auth/login
```json
// Response
{
  "success": true,
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "subject_id": "S001",
    "session": {
      "current_round": 15,
      "total_rounds": 45,
      "status": "in_progress",
      "can_resume": true,
      "last_round_completed_at": "2026-02-04T15:00:00",
      "days_since_last_round": 1.5
    }
  }
}
```

#### POST /api/v1/auth/anonymous
```json
// Response
{
  "success": true,
  "data": {
    "anonymous_id": "ANON_001",
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "mode": "practice_only",
    "expires_in": 7200
  }
}
```

### 4.2 实验模块

#### POST /api/v1/experiment/start-practice
```json
// Request
{
  "practice_trials": 40  // 用户选择：24/40/60/80
}

// Response
{
  "success": true,
  "data": {
    "session_id": "sess_practice_001",
    "practice_trials": 40,
    "pass_threshold": 0.70,
    "stimuli_order": ["img1.png", "img2.png", ...]
  }
}
```

#### POST /api/v1/experiment/submit-practice
```json
// Request
{
  "session_id": "sess_practice_001",
  "trials": [...],
  "accuracy": 0.75
}

// Response
{
  "success": true,
  "data": {
    "accuracy": 0.75,
    "passed": true,
    "message": "恭喜！练习达标，可以进入正式实验",
    "next_action": "start_formal"
  }
}
```

#### GET /api/v1/experiment/config
```json
// Response
{
  "success": true,
  "data": {
    "experiment": {
      "name": "认知行为-Mnist数字识别实验",
      "practice_trials_options": [24, 40, 60, 80],
      "practice_pass_threshold": 0.70,
      "formal_rounds": 45,
      "trials_per_round": 40,
      "resources_base_url": "/resources",
      "fullscreen_warning": "实验将全屏显示，请勿点击其他地方",
      "interrupt_warning": "点击其他地方会导致实验中断，数据将不可用"
    },
    "stimuli": {
      "simple": ["normal_lbl3_0030_a20.png", ...],
      "complex": ["normal_lbl3_0930_a46.png", ...],
      "sub": ["normal_lbl3_0137_a30.png", ...]
    }
  }
}
```

#### POST /api/v1/experiment/start-round
```json
// Request
{
  "round_number": 16
}

// Response
{
  "success": true,
  "data": {
    "session_id": "sess_formal_001",
    "round_number": 16,
    "stimuli_order": ["img1.png", "img2.png", ...],
    "start_time": "2026-02-05T15:00:00",
    "warning": null,  // 或 "距上次实验已过去2天，数据可靠性可能降低"
    "fullscreen_required": true,
    "interrupt_warning": "点击其他地方会导致实验中断"
  }
}
```

#### POST /api/v1/experiment/submit-round
```json
// Request
{
  "session_id": "sess_formal_001",
  "round_number": 16,
  "trials": [...],
  "round_summary": {
    "accuracy": 0.85,
    "avg_rt": 520
  },
  "interrupted": false  // 是否中断
}

// Response
{
  "success": true,
  "data": {
    "saved_count": 40,
    "file_path": "/data/subjects/registered/S001/rounds/round_16_20260205_150000.csv",
    "progress": {
      "completed_rounds": 16,
      "total_rounds": 45,
      "percent": 35.6,
      "next_round": 17
    },
    "next_action": "continue"
  }
}
```

#### POST /api/v1/experiment/report-interrupt
```json
// 实验中断时调用
// Request
{
  "round_number": 16,
  "completed_trials": 20,
  "reason": "fullscreen_exit"
}

// Response
{
  "success": true,
  "data": {
    "message": "实验已中断，本轮数据不可用",
    "can_restart": true,
    "restart_round": 16
  }
}
```

#### POST /api/v1/experiment/pause
```json
// Request
{
  "current_round": 16
}

// Response
{
  "success": true,
  "data": {
    "message": "进度已保存，您可以随时回来继续",
    "resume_url": "https://cognitive-testing.cn/resume?token=xxx",
    "warning": "建议24小时内继续，以保证数据可靠性"
  }
}
```

### 4.3 数据模块

#### GET /api/v1/data/download/{subject_id}
```json
// Response
{
  "success": true,
  "data": {
    "subject_id": "S001",
    "experiment_name": "认知行为-Mnist数字识别实验",
    "sessions": [
      {
        "session_id": 1,
        "practice_data": "/api/v1/data/file/S001/practice/practice_data.csv",
        "practice_accuracy": 0.75,
        "rounds": [
          {
            "round": 1,
            "file": "...",
            "accuracy": 0.82,
            "avg_rt": 510,
            "started_at": "2026-02-05T10:00:00",
            "completed_at": "2026-02-05T10:05:00"
          },
          ...
        ]
      }
    ],
    "summary": {
      "total_rounds_completed": 16,
      "overall_accuracy": 0.84,
      "overall_avg_rt": 515,
      "total_time_spent": "75分钟"
    }
  }
}
```

---

## 五、前端页面流程

```
┌─────────────────────────────────────────────────────────────────────┐
│                              首页                                   │
│                    （实验介绍 + 两个入口）                            │
└───────────────────────────┬─────────────────────────────────────────┘
                            │
            ┌───────────────┴───────────────┐
            │                               │
            ▼                               ▼
┌───────────────────────┐       ┌───────────────────────┐
│    "我想先试试"        │       │    "我要正式参加"      │
│     （匿名练习）       │       │     （注册/登录）      │
└───────────┬───────────┘       └───────────┬───────────┘
            │                               │
            ▼                               ▼
┌───────────────────────┐       ┌───────────────────────┐
│   匿名用户直接进入      │       │   登录/注册页面        │
│   练习实验             │       │                       │
│   ID: ANON_XXX        │       └───────────┬───────────┘
└───────────┬───────────┘                   │
            │                   ┌───────────┴───────────┐
            │                   │                       │
            │                   ▼                       ▼
            │       ┌───────────────────┐   ┌───────────────────┐
            │       │   已有账号登录      │   │   新用户注册       │
            │       └─────────┬─────────┘   └─────────┬─────────┘
            │                 │                       │
            │                 └───────────┬───────────┘
            │                             │
            │                             ▼
            │               ┌───────────────────────────┐
            │               │   基本信息表单             │
            │               │   （年龄/性别/教育程度）    │
            │               └─────────────┬─────────────┘
            │                             │
            └─────────────┬───────────────┘
                          │
                          ▼
            ┌───────────────────────────────┐
            │      知情同意书页面            │
            │   （实验目的/数据使用/自愿参与）│
            └───────────────┬───────────────┘
                            │
                            ▼
            ┌───────────────────────────────┐
            │      练习设置页面              │
            │   - 选择练习试次数（24/40/60/80）│
            │   - 全屏显示警告说明            │
            └───────────────┬───────────────┘
                            │
                          ▼
            ┌───────────────────────────────┐
            │      练习实验（PsychoJS）      │
            │   - 全屏显示                   │
            │   - 中断检测                   │
            └───────────────┬───────────────┘
                            │
                          ▼
            ┌───────────────────────────────┐
            │      练习结果页面              │
            │   - 显示正确率                 │
            │   - 达标(≥70%)→进入正式实验    │
            │   - 未达标→重新练习             │
            └───────────────┬───────────────┘
                            │
                          ▼
            ┌───────────────────────────────┐
            │      正式实验警告页面          │
            │   - 全屏显示警告               │
            │   - 中断警告                   │
            └───────────────┬───────────────┘
                            │
                          ▼
            ┌───────────────────────────────┐
            │      用户中心/进度页           │
            │   - 显示已完成轮数             │
            │   - 检查轮次间隔（>1天警告）    │
            │   - 继续下一轮/重新开始        │
            └───────────────┬───────────────┘
                            │
                          ▼
            ┌───────────────────────────────┐
            │      正式实验（PsychoJS）      │
            │   - 全屏显示                   │
            │   - 中断检测                   │
            │   - 轮次结束自动上传数据        │
            └───────────────┬───────────────┘
                            │
            ┌───────────────┼───────────────┐
            │               │               │
            ▼               ▼               ▼
┌──────────────────┐ ┌──────────────┐ ┌──────────────────┐
│  本轮完成         │ │  全部45轮完成 │ │  选择"下次继续"  │
│  （继续下一轮）   │ │  （感谢页面） │ │  （保存进度）    │
└──────────────────┘ └──────────────┘ └──────────────────┘
```

---

## 六、PsychoJS 改造方案

### 6.1 改造1：资源路径替换
```javascript
// 修改前
resources: [
  {'name': 'generated_dataset/simple/xxx.png', 'path': 'generated_dataset/simple/xxx.png'},
  ...
]

// 修改后
resources: [
  {'name': 'generated_dataset/simple/xxx.png', 'path': '/resources/generated_dataset/simple/xxx.png'},
  ...
]
```

### 6.2 改造2：获取 URL 参数
```javascript
function getUrlParams() {
  const params = new URLSearchParams(window.location.search);
  return {
    token: params.get('token'),
    subject_id: params.get('sid'),
    round: parseInt(params.get('round')) || 1,
    mode: params.get('mode') || 'formal',
    practice_trials: parseInt(params.get('practice_trials')) || 24
  };
}

const urlParams = getUrlParams();
```

### 6.3 改造3：全屏检测与中断处理
```javascript
// 监听全屏变化
document.addEventListener('fullscreenchange', handleFullscreenChange);
document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
document.addEventListener('visibilitychange', handleVisibilityChange);

function handleFullscreenChange() {
  if (!document.fullscreenElement && !document.webkitFullscreenElement) {
    // 用户退出全屏
    reportInterrupt('fullscreen_exit');
    showInterruptWarning();
  }
}

function handleVisibilityChange() {
  if (document.hidden) {
    // 用户切换到其他标签页
    reportInterrupt('tab_switch');
    showInterruptWarning();
  }
}

async function reportInterrupt(reason) {
  await fetch('/api/v1/experiment/report-interrupt', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${urlParams.token}`
    },
    body: JSON.stringify({
      round_number: currentRound,
      completed_trials: currentTrial,
      reason: reason
    })
  });
}
```

### 6.4 改造4：数据上传函数
```javascript
async function uploadRoundData(roundNumber, trialsData, summary) {
  const apiUrl = '/api/v1/experiment/submit-round';
  
  try {
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${urlParams.token}`
      },
      body: JSON.stringify({
        round_number: roundNumber,
        trials: trialsData,
        round_summary: summary,
        interrupted: false
      })
    });
    
    if (!response.ok) {
      localStorage.setItem(`pending_round_${roundNumber}`, JSON.stringify(trialsData));
      throw new Error('上传失败，已保存到本地');
    }
    
    return await response.json();
  } catch (error) {
    console.error('数据上传错误:', error);
    showMessage('数据保存失败，请勿关闭页面');
  }
}
```

### 6.5 改造5：练习达标检测
```javascript
async function checkPracticeAccuracy(trialsData) {
  const correctCount = trialsData.filter(t => t.accuracy).length;
  const accuracy = correctCount / trialsData.length;
  
  const result = await fetch('/api/v1/experiment/submit-practice', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${urlParams.token}`
    },
    body: JSON.stringify({
      trials: trialsData,
      accuracy: accuracy
    })
  });
  
  const data = await result.json();
  
  if (data.passed) {
    showMessage('恭喜！练习达标，可以进入正式实验');
    setTimeout(() => window.location.href = '/formal-intro', 2000);
  } else {
    showMessage(`正确率 ${(accuracy*100).toFixed(1)}%，需要 ≥70%，请重新练习`);
    setTimeout(() => window.location.reload(), 3000);
  }
}
```

### 6.6 改造6：轮次间隔警告
```javascript
async function checkRoundInterval() {
  const response = await fetch('/api/v1/experiment/progress', {
    headers: { 'Authorization': `Bearer ${urlParams.token}` }
  });
  
  const progress = await response.json();
  
  if (progress.days_since_last_round > 1) {
    showWarning(`距上次实验已过去 ${progress.days_since_last_round.toFixed(1)} 天，数据可靠性可能降低`);
  }
}
```

---

## 七、Docker 部署配置

### 7.1 docker-compose.yml
```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    container_name: exp_backend
    restart: unless-stopped
    environment:
      - DATABASE_URL=sqlite:///data/experiment.db
      - SECRET_KEY=${SECRET_KEY}
      - ACCESS_TOKEN_EXPIRE_MINUTES=120
    volumes:
      - ./data:/data
    networks:
      - exp_network

  frontend:
    build: ./frontend
    container_name: exp_frontend
    restart: unless-stopped
    networks:
      - exp_network

  nginx:
    image: nginx:alpine
    container_name: exp_nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./data:/data:ro
      - ./certbot/conf:/etc/letsencrypt:ro
      - ./certbot/www:/var/www/certbot:ro
    depends_on:
      - backend
      - frontend
    networks:
      - exp_network

networks:
  exp_network:
    driver: bridge
```

### 7.2 nginx.conf
```nginx
upstream backend {
    server backend:8000;
}

upstream frontend {
    server frontend:80;
}

server {
    listen 80;
    server_name cognitive-testing.cn;
    
    location / {
        return 301 https://$server_name$request_uri;
    }
    
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }
}

server {
    listen 443 ssl http2;
    server_name cognitive-testing.cn;
    
    ssl_certificate /etc/letsencrypt/live/cognitive-testing.cn/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/cognitive-testing.cn/privkey.pem;
    
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    
    location / {
        proxy_pass http://frontend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /resources/ {
        alias /data/resources/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

---

## 八、开发时间线（14天）

| 阶段 | 天数 | 任务 | 产出 |
|------|------|------|------|
| **阶段一** | Day 1-2 | 基础设施 | Debian 12.10、Docker、Nginx |
| **阶段二** | Day 3-5 | 后端开发 | FastAPI + SQLite + API |
| **阶段三** | Day 6-8 | 前端开发 | Vue 3 登录/用户中心/练习设置 |
| **阶段四** | Day 9-11 | PsychoJS改造 | 全屏检测、数据上传、中断处理 |
| **阶段五** | Day 12-13 | 集成测试 | 完整流程测试 |
| **阶段六** | Day 14 | 部署上线 | 生产环境部署 |

---

## 九、风险与应对

| 风险 | 可能性 | 影响 | 应对 |
|------|--------|------|------|
| 45轮实验太长，被试流失 | 高 | 高 | 允许分多天完成，进度自动保存，轮次间隔>1天警告 |
| 图片加载慢 | 低 | 中 | 790KB很小，Nginx缓存即可 |
| 浏览器兼容性问题 | 中 | 中 | 测试Chrome/Edge/Safari |
| 数据上传失败 | 低 | 高 | 本地存储备份，自动重试 |
| 用户误触导致中断 | 中 | 中 | 全屏检测+中断警告+可重新开始本轮 |

---

## 十、配置参数汇总

| 参数 | 值 | 说明 |
|------|-----|------|
| 域名 | cognitive-testing.cn | 已确认 |
| 实验名称 | 认知行为-Mnist数字识别实验 | 已确认 |
| 操作系统 | Debian 12.10 | 已确认 |
| 练习试次选项 | [24, 40, 60, 80] | 用户可选 |
| 练习达标标准 | ≥70% 正确率 | 已确认 |
| 正式实验轮数 | 45 轮 | 每轮40试次 |
| 轮次间隔警告 | >1 天 | 已确认 |
| 全屏显示 | 必需 | 实验期间保持全屏 |
| 中断处理 | 本轮数据不可用 | 可重新开始本轮 |

---

## 十一、服务器状态检查

### 11.1 连接信息

| 项目 | 值 |
|------|-----|
| 公网IP | 8.135.6.165 |
| 私有IP | 172.17.43.191 |
| SSH端口 | 22 |
| 用户名 | root |
| 操作系统 | Debian GNU/Linux 12 (bookworm) |
| 内核版本 | 6.1.0-33-amd64 |

### 11.2 系统资源

| 项目 | 状态 | 说明 |
|------|------|------|
| CPU | ✅ 2核 | Intel Xeon Platinum |
| 内存 | ⚠️ 1.6GB | 需要配置Swap |
| 磁盘 | ✅ 40GB | 已用2.5GB，剩余35GB |
| Swap | ❌ 未配置 | **必须配置2GB** |

### 11.3 软件环境

| 项目 | 状态 | 版本/说明 |
|------|------|----------|
| Python | ✅ 已安装 | 3.11.2 |
| Docker | ❌ 未安装 | 需要安装 |
| Node.js | ❌ 未安装 | 可选（前端构建用） |
| Nginx | ❌ 未安装 | 需要安装 |
| BBR | ❌ 未开启 | **必须开启**（当前cubic） |

### 11.4 待配置项

1. **配置Swap**（2GB）- 防止内存不足
2. **开启BBR** - 网络加速优化
3. **安装Docker** - 容器化部署
4. **安装Nginx** - 反向代理
5. **配置SSL** - HTTPS证书

---

## 十二、开发模式与Git配置

### 12.1 开发模式确认

**采用方案**：C（混合模式）✅

**工作流程**：
1. 先在阿里云服务器完成基础配置（Swap、BBR、Docker）
2. 在本地开发核心代码
3. 通过Git同步到服务器部署
4. 在服务器上进行最终测试

### 12.2 Git 仓库配置

**仓库信息**：
- 仓库名称：`cognitive-experiment-platform`
- 开源协议：MIT License
- 主平台：GitHub
- 镜像平台：Gitee（国内加速）

**本地仓库状态**：
- 初始化状态：✅ 已完成
- 分支：`main`
- 项目结构：已创建

**项目目录结构**：
```
cognitive-experiment-platform/
├── backend/           # FastAPI 后端
├── frontend/          # Vue 3 前端
├── nginx/             # Nginx 配置
├── psychojs/          # PsychoJS 实验文件
├── docs/              # 项目文档
│   ├── 实施计划.md
│   ├── 项目进度.md
│   └── 开发日志/       # 开发进度记录
├── data/              # 数据存储目录（不提交Git）
├── README.md          # 项目说明
└── .gitignore         # Git 忽略配置
```

### 12.3 开发日志规范

**存放位置**：`docs/开发日志/`

**命名规范**：`YYYY-MM-DD-简短描述.md`

**日志列表**：
- [2026-02-05-项目初始化](./docs/开发日志/2026-02-05-项目初始化.md)

---

## 十三、下一步行动

### 立即执行（等待确认）
1. ⏳ **服务器基础配置**：Swap、BBR、Docker
2. ⏳ **本地代码开发**：FastAPI后端 + Vue前端
3. ⏳ **部署脚本编写**：自动化部署流程

### 决策点
**请确认**：
1. 采用哪种开发模式？（A/B/C）
2. 是否立即开始服务器配置？
3. 是否需要我先编写部署脚本？

---

## 十四、相关文档

- [项目进度.md](./项目进度.md) - 详细进度跟踪
- [计划.md](./计划.md) - 初始计划草案
- [实验/](./实验/) - PsychoPy导出文件

---

> 本计划书将根据实际开发进展持续更新。
